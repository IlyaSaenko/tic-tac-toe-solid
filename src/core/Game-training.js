
// 1Ô∏è‚É£ –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–æ—Å–∫—É ‚Äî –æ–±—ä–µ–∫—Ç Board
// 2Ô∏è‚É£ –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–≥—Ä–æ–∫–∞ (HumanPlayer)
// 3Ô∏è‚É£ –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä (ComputerPlayer)
// 4Ô∏è‚É£ –≠–ª–µ–º–µ–Ω—Ç, –∫—É–¥–∞ –±—É–¥–µ–º –≤—ã–≤–æ–¥–∏—Ç—å —Ç–µ–∫—Å—Ç "–•–æ–¥: ..."
// 5Ô∏è‚É£ –¢–µ–∫—É—â–∏–π –∏–≥—Ä–æ–∫ ‚Äî –æ–ø—Ä–µ–¥–µ–ª–∏–º –ø–æ–∑–∂–µ
// 6Ô∏è‚É£ –§–ª–∞–≥, —á—Ç–æ–±—ã –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
// 7Ô∏è‚É£ –ö–æ–ª–±—ç–∫, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏)
export default class Game {
  constructor(player, computer, boardContainer, currentTurnElement, onFinish = null) {
    this.board = boardContainer;
    this.player = player;
    this.computer = computer;
    this.currentTurnElement = currentTurnElement;
    this.currentPlayer = null;
    this.isGameOver = false;
    this.onFinish = onFinish;
  }

  //start() //todo
  // 8Ô∏è‚É£ –ò–≥—Ä–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è ‚Äî —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
  // 9Ô∏è‚É£ –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—É—é –¥–æ—Å–∫—É (–æ—á–∏—Å—Ç–∫–∞ + 9 –∫–ª–µ—Ç–æ–∫)
  // üîü –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫—Ç–æ —Ö–æ–¥–∏—Ç –ø–µ—Ä–≤—ã–π
  // –ï—Å–ª–∏ —É –∏–≥—Ä–æ–∫–∞ –º–∞—Ä–∫–µ—Ä 'X' ‚Üí –æ–Ω –Ω–∞—á–∏–Ω–∞–µ—Ç, –∏–Ω–∞—á–µ –∫–æ–º–ø—å—é—Ç–µ—Ä
  // 1Ô∏è‚É£1Ô∏è‚É£ –ó–∞–ø—É—Å–∫–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –∏–≥—Ä—ã
  async start() {
    this.isGameOver = false;
    this.board.create();
    this.currentPlayer = this.player.marker === 'X' ? this.player : this.computer;
    await loopGame();
  }

  //loopGame() //todo
  // 1Ô∏è‚É£2Ô∏è‚É£ –ü–æ–∫–∞ –Ω–µ—Ç –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –∏ –Ω–µ—Ç –Ω–∏—á—å–µ–π ‚Äî –∏–≥—Ä–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è
  // 1Ô∏è‚É£3Ô∏è‚É£ –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç "–•–æ–¥: –ò–≥—Ä–æ–∫ (X)" –∏–ª–∏ "–•–æ–¥: –ö–æ–º–ø—å—é—Ç–µ—Ä (O)"
  // 1Ô∏è‚É£4Ô∏è‚É£ currentPlayer ‚Äî —ç—Ç–æ –æ–±—ä–µ–∫—Ç Player, —É –Ω–µ–≥–æ –µ—Å—Ç—å –º–µ—Ç–æ–¥ getMove()
  // —Å–æ–∑–¥–∞—ë–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞ —Ö–æ–¥–∞, idx ‚Äî —ç—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ö–æ–¥–∞ –∏–≥—Ä–æ–∫–∞.
  // –ø—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å—Ç—å –ª–∏ —É —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞ –º–µ—Ç–æ–¥ getMove?
  // ¬´–ï—Å–ª–∏ —É —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞ –µ—Å—Ç—å –º–µ—Ç–æ–¥ getMove ‚Äî –ø–æ–ø—Ä–æ—Å–∏ –∏–≥—Ä–æ–∫–∞ —Å–¥–µ–ª–∞—Ç—å —Ö–æ–¥ –∏ –ø–æ–¥–æ–∂–¥–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç¬ª.
  // (—É –æ–±–æ–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ –æ–Ω –µ—Å—Ç—å ‚Äî —ç—Ç–æ –ø–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º –≤ —á–∏—Å—Ç–æ–º –≤–∏–¥–µ)
  // await ‚Äî –ø–æ—Ç–æ–º—É —á—Ç–æ getMove –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ–º–∏—Å, –∂–¥—ë–º, –ø–æ–∫–∞ –∏–≥—Ä–æ–∫ (—á–µ–ª–æ–≤–µ–∫ –∏–ª–∏ –∫–æ–º–ø—å—é—Ç–µ—Ä) —Å–¥–µ–ª–∞–µ—Ç —Ö–æ–¥
  // –ø—Ä–æ–≤–µ—Ä—è–µ–º, –ø—Ä–∏—à—ë–ª –ª–∏ —Ö–æ–¥
  // 1Ô∏è‚É£5Ô∏è‚É£–ï—Å–ª–∏ —Ö–æ–¥ –±—ã–ª —Å–¥–µ–ª–∞–Ω (idx –æ–ø—Ä–µ–¥–µ–ª—ë–Ω) ‚Äî —Å—Ç–∞–≤–∏–º –º–∞—Ä–∫–µ—Ä
  //¬´–ï—Å–ª–∏ –∏–≥—Ä–æ–∫ —Ä–µ–∞–ª—å–Ω–æ –≤—ã–±—Ä–∞–ª –∫–ª–µ—Ç–∫—É ‚Äî –ø–æ—Å—Ç–∞–≤—å –µ–≥–æ —Å–∏–º–≤–æ–ª (X –∏–ª–∏ O) –Ω–∞ –¥–æ—Å–∫—É¬ª.
  // –í—ã–∑—ã–≤–∞–µ–º –º–µ—Ç–æ–¥ –¥–æ—Å–∫–∏, –∫–æ—Ç–æ—Ä—ã–π –æ–±–Ω–æ–≤–ª—è–µ—Ç state –∏ UI
  // 1Ô∏è‚É£6Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥—ã ‚Äî –∏—â–µ–º –≤—ã–∏–≥—Ä—ã—à–Ω—É—é –∫–æ–º–±–∏–Ω–∞—Ü–∏—é
  // 1Ô∏è‚É£7Ô∏è‚É£ –ï—Å–ª–∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏—è –Ω–∞–π–¥–µ–Ω–∞ ‚Üí –∏–≥—Ä–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –ø–æ–±–µ–¥–æ–π currentPlayer
  // 1Ô∏è‚É£8Ô∏è‚É£ –ï—Å–ª–∏ –ø–æ–±–µ–¥—ã –Ω–µ—Ç, –Ω–æ –ø–æ–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ ‚Äî –Ω–∏—á—å—è
  // 1Ô∏è‚É£9Ô∏è‚É£ –ü–µ—Ä–µ–¥–∞—ë–º —Ö–æ–¥ –¥—Ä—É–≥–æ–º—É –∏–≥—Ä–æ–∫—É:
  // –µ—Å–ª–∏ –±—ã–ª –∏–≥—Ä–æ–∫ ‚Äî —Å—Ç–∞–Ω–µ—Ç –∫–æ–º–ø—å—é—Ç–µ—Ä, –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç
  async loopGame() {
    while (!this.isGameOver) {
      this.updateTurnText();

      let idx;
      if (this.currentPlayer.getMove) {
        idx = await this.currentPlayer.getMove(this.board);
      }
      if (idx !== undefined) {
        this.board.setMarker(idx, this.currentPlayer.marker)
      }

      const winCombo = this.board.checkWin(this.currentPlayer);
      if (winCombo) return this.endGame(this.currentPlayer);
      if (this.board.isFull()) return this.endGame(null);

      this.currentPlayer = this.currentPlayer === this.player ? this.computer : this.player;
    }
  }

  //updateTurnText() //todo
  // 2Ô∏è‚É£0Ô∏è‚É£ –ú–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç —Å–≤–µ—Ä—Ö—É ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º, —á–µ–π —Ö–æ–¥ —Å–µ–π—á–∞—Å
  updateTurnText() {
    this.currentTurnElement.textContent = `–•–æ–¥: ${this.currentPlayer.name} (${this.currentPlayer.marker})`;
  }
  //endGame(winner) //todo
  // 2Ô∏è‚É£1Ô∏è‚É£ –ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ –ø–æ–±–µ–¥–∏–ª
  // 2Ô∏è‚É£2Ô∏è‚É£ –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –≤—ã–∏–≥—Ä—ã—à–Ω—ã–µ –∫–ª–µ—Ç–∫–∏
  // 2Ô∏è‚É£3Ô∏è‚É£ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç "–ò–≥—Ä–æ–∫ –ø–æ–±–µ–¥–∏–ª!"
  // 2Ô∏è‚É£4Ô∏è‚É£ –ù–∏—á—å—è
  // 2Ô∏è‚É£5Ô∏è‚É£ –û—Ç–∫–ª—é—á–∞–µ–º –¥–æ—Å–∫—É ‚Äî –±–æ–ª—å—à–µ –Ω–µ–ª—å–∑—è –∫–ª–∏–∫–∞—Ç—å
  // 2Ô∏è‚É£6Ô∏è‚É£ –°—Ç–∞–≤–∏–º —Ñ–ª–∞–≥, —á—Ç–æ –∏–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞, —á—Ç–æ–±—ã –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å loopGame()
  // 2Ô∏è‚É£7Ô∏è‚É£ –ï—Å–ª–∏ –µ—Å—Ç—å callback onFinish ‚Üí –≤—ã–∑—ã–≤–∞–µ–º —Å —Ç–∏–ø–æ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
  // 2Ô∏è‚É£8Ô∏è‚É£ –°–æ–æ–±—â–∞–µ–º –Ω–∞—Ä—É–∂—É: –∫—Ç–æ –ø–æ–±–µ–¥–∏–ª (–¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ —Ç.–¥.)
  endGame(winner) {
    if (winner) {
      this.board.highlightWinningCells(this.board.checkWin(winner.marker));
      this.currentTurnElement.textContent = `${winner.name} –ø–æ–±–µ–¥–∏–ª! üéâ`;
    } else {
      this.currentTurnElement.textContent = '–ù–∏—á—å—è ü§ù'
    }

    this.board.disable();
    this.isGameOver = true;

    if (this.onFinish) {
      const kind = winner === this.player ? 'player' : winner === this.computer ? 'computer' : 'draw';
      this.onFinish(kind);
    }
  }
}
